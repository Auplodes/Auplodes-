<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaClone - Personal Cloud Storage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bg-media { background-color: #f3f5f7; }
        .blue-gradient { background: linear-gradient(90deg, #007bff 0%, #0056b3 100%); }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-media">

    <nav class="blue-gradient p-4 text-white flex justify-between items-center shadow-lg">
        <h1 class="text-2xl font-bold">MediaClone</h1>
        <div id="user-info" class="flex items-center gap-4">
            <span id="user-email" class="hidden text-sm"></span>
            <button id="logout-btn" class="hidden bg-red-500 px-3 py-1 rounded text-sm">Logout</button>
        </div>
    </nav>

    <div id="auth-container" class="max-w-md mx-auto mt-20 bg-white p-8 rounded-lg shadow-xl">
        <h2 id="auth-title" class="text-2xl font-bold mb-6 text-center text-blue-600">Login to your account</h2>
        <input type="email" id="email" placeholder="Email" class="w-full p-3 border mb-4 rounded">
        <input type="password" id="password" placeholder="Password" class="w-full p-3 border mb-4 rounded">
        <button id="auth-action-btn" class="w-full bg-blue-600 text-white p-3 rounded font-bold hover:bg-blue-700">Login</button>
        <p class="mt-4 text-center text-sm">
            Don't have an account? <span id="toggle-auth" class="text-blue-600 cursor-pointer underline">Sign up here</span>
        </p>
    </div>

    <main id="dashboard" class="hidden container mx-auto mt-10 p-6 bg-white shadow-md rounded-lg max-w-4xl">
        <div class="text-center border-2 border-dashed border-gray-300 p-10 rounded-lg">
            <h2 class="text-xl mb-4 font-semibold">Upload your files</h2>
            <input type="file" id="fileInput" class="hidden">
            <label for="fileInput" class="bg-blue-600 text-white px-6 py-3 rounded cursor-pointer hover:bg-blue-700 transition">
                Select Files to Upload
            </label>
            <p id="upload-status" class="mt-4 text-sm font-medium text-blue-500"></p>
        </div>

        <div class="mt-10">
            <h3 class="text-lg font-bold border-b pb-2 mb-4">Your Cloud Files</h3>
            <div id="fileList" class="space-y-3">
                <p class="text-gray-500">Scanning for files...</p>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, listAll } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Your Firebase Configuration (Using the config you provided)
        const firebaseConfig = {
            apiKey: "AIzaSyD6DXAvR8mkkNRd3jCqJYlZ45TZPoLCpcE",
            authDomain: "auplodes-f9108.firebaseapp.com",
            projectId: "auplodes-f9108",
            storageBucket: "auplodes-f9108.firebasestorage.app",
            messagingSenderId: "362749747108",
            appId: "1:362749747108:web:613c05b336cd966859eb31",
            measurementId: "G-EFRKXLN0W0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const storage = getStorage(app);

        // Elements
        const authContainer = document.getElementById('auth-container');
        const dashboard = document.getElementById('dashboard');
        const emailInput = document.getElementById('email');
        const passInput = document.getElementById('password');
        const authBtn = document.getElementById('auth-action-btn');
        const toggleAuth = document.getElementById('toggle-auth');
        const authTitle = document.getElementById('auth-title');
        const userEmailSpan = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');

        let isLogin = true;

        // Toggle Login/Signup
        toggleAuth.onclick = () => {
            isLogin = !isLogin;
            authTitle.innerText = isLogin ? "Login to your account" : "Create an account";
            authBtn.innerText = isLogin ? "Login" : "Sign Up";
            toggleAuth.innerText = isLogin ? "Sign up here" : "Login here";
        };

        // Auth Action
        authBtn.onclick = async () => {
            const email = emailInput.value;
            const password = passInput.value;
            try {
                if (isLogin) {
                    await signInWithEmailAndPassword(auth, email, password);
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                }
            } catch (err) { alert(err.message); }
        };

        // Logout
        logoutBtn.onclick = () => signOut(auth);

        // State Change (Check if user is logged in)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authContainer.classList.add('hidden');
                dashboard.classList.remove('hidden');
                userEmailSpan.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');
                userEmailSpan.innerText = user.email;
                loadFiles(user.uid);
            } else {
                authContainer.classList.remove('hidden');
                dashboard.classList.add('hidden');
                userEmailSpan.classList.add('hidden');
                logoutBtn.classList.add('hidden');
            }
        });

        // File Upload
        const fileInput = document.getElementById('fileInput');
        const uploadStatus = document.getElementById('upload-status');

        fileInput.onchange = async (e) => {
            const file = e.target.files[0];
            const user = auth.currentUser;
            if (!file || !user) return;

            const fileRef = ref(storage, `users/${user.uid}/${file.name}`);
            uploadStatus.innerText = "Uploading...";

            try {
                await uploadBytes(fileRef, file);
                uploadStatus.innerText = "Upload Complete!";
                loadFiles(user.uid);
            } catch (err) { uploadStatus.innerText = "Error: " + err.message; }
        };

        // Load Files
        async function loadFiles(uid) {
            const fileList = document.getElementById('fileList');
            const listRef = ref(storage, `users/${uid}/`);
            try {
                const res = await listAll(listRef);
                fileList.innerHTML = res.items.length ? "" : "No files yet.";
                res.items.forEach(async (item) => {
                    const url = await getDownloadURL(item);
                    const div = document.createElement('div');
                    div.className = "flex justify-between items-center p-4 bg-gray-50 border rounded shadow-sm";
                    div.innerHTML = `
                        <span class="truncate w-1/2">${item.name}</span>
                        <a href="${url}" target="_blank" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">Download</a>
                    `;
                    fileList.appendChild(div);
                });
            } catch (err) { console.error(err); }
        }
    </script>
</body>
            </html>
    
